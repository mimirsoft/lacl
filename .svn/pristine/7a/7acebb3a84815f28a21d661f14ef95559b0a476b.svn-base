<?php

include("../../globalconstants.php");
include("../../Database_Mysql.class.php");
include("../../User.class.php");
include("../../Application.class.php");
include("../../Access_Code.class.php");
include("../../Token.class.php");

@$client_id=$_REQUEST['client_id'];
@$redirect_uri=$_REQUEST['redirect_uri'];
@$code=$_REQUEST['code'];
@$client_secret=$_REQUEST['client_secret'];
//if scope was set, parse it into an array
$application = new Application($client_id);
$access_code = new Access_Code($code);


//check our client with our secret
if($application->getApplicationSecret() != $client_secret && $client_secret != "")
{
    $array['message'] = "IncorrectApplicationSecret";
	$array['error'] = true;
	echo json_encode($array);
	exit;
}
//if good match, check if code's app id matches our app id
if($access_code->getApplicationId() == $application->getApplicationId())
{
    
    if($access_code->getUserId() != '')
    {
        //if valid, create token
        $token = new Token($access_code->getUserId());
        $token->getToken();
        
        //insert token
        $array['access_token'] = $token->getToken();
    	$array['expires'] = 3600;
    	echo json_encode($array);
    	
    }
}






?>
